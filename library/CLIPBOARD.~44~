(DEFINE-FILE-INFO READTABLE "INTERLISP" PACKAGE "INTERLISP")(FILECREATED "30-Jul-2020 21:33:30" {DSK}<Users>kaplan>Local>medley3.5>lispcore>library>CLIPBOARD.;44 8581         changes to%:  (VARS CLIPBOARDCOMS CBUNICODETOXEROXRENDERING)                    (FNS GETCLIPBOARD PUTCLIPBOARD)      previous date%: "24-Jun-2020 20:17:42" {DSK}<Users>kaplan>Local>medley3.5>lispcore>library>CLIPBOARD.;41)(PRETTYCOMPRINT CLIPBOARDCOMS)(RPAQQ CLIPBOARDCOMS       [                                                     (* ; "Enable copy and paste")        (FNS INSTALL-CLIPBOARD GETCLIPBOARD PUTCLIPBOARD PASTEFROMCLIPBOARD LISPINTERRUPTS.PASTE)        (FNS TEDIT.COPYTOCLIPBOARD TEDIT.EXTRACTTOCLIPBOARD TEDIT.SELECTALL)        (FNS SEDIT.COPYTOCLIPBOARD)        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DOCOPY (FILES (SYSLOAD)                                                              UNIXCOMM UNICODE)               (P (INSTALL-CLIPBOARD)))        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA)                                                                             (NLAML)                                                                             (LAMA PUTCLIPBOARD])(* ; "Enable copy and paste")(DEFINEQ(INSTALL-CLIPBOARD  [LAMBDA NIL                                           (* ; "Edited 24-Jun-2020 20:14 by rmk:")                                                            (* ; "Edited 19-Apr-2020 12:15 by rmk:")                                                            (* ; "Edited 18-Apr-2018 23:00 by rmk:")    (CL:WHEN (GETD 'LISPINTERRUPTS.PASTE)        (MOVD? 'LISPINTERRUPTS 'LISPINTERRUPTS.ORIG)        (MOVD 'LISPINTERRUPTS.PASTE 'LISPINTERRUPTS))    (INTERRUPTCHAR (CHARCODE "1,v")           '(PASTEFROMCLIPBOARD))    (INTERRUPTCHAR (CHARCODE "1,V")           '(PASTEFROMCLIPBOARD))    (CL:WHEN (BOUNDP 'TEDIT.READTABLE)                       (* ; "TEDIT")        (* ;; "Paste")        (TEDIT.SETFUNCTION (CHARCODE "1,v")               (FUNCTION PASTEFROMCLIPBOARD)               TEDIT.READTABLE)        (TEDIT.SETFUNCTION (CHARCODE "1,V")               (FUNCTION PASTEFROMCLIPBOARD)               TEDIT.READTABLE)        (* ;; "Copy")        (TEDIT.SETFUNCTION (CHARCODE "1,c")               (FUNCTION TEDIT.COPYTOCLIPBOARD)               TEDIT.READTABLE)        (TEDIT.SETFUNCTION (CHARCODE "1,C")               (FUNCTION TEDIT.COPYTOCLIPBOARD)               TEDIT.READTABLE)        (* ;; "Extract")        (TEDIT.SETFUNCTION (CHARCODE "1,X")               (FUNCTION TEDIT.EXTRACTTOCLIPBOARD)               TEDIT.READTABLE)        (TEDIT.SETFUNCTION (CHARCODE "1,x")               (FUNCTION TEDIT.EXTRACTTOCLIPBOARD)               TEDIT.READTABLE)        (* ;; "All")        (TEDIT.SETFUNCTION (CHARCODE "1,a")               (FUNCTION TEDIT.SELECTALL)               TEDIT.READTABLE)        (TEDIT.SETFUNCTION (CHARCODE "1,A")               (FUNCTION TEDIT.SELECTALL)               TEDIT.READTABLE)        (* ;; "Quit")        (TEDIT.SETFUNCTION (CHARCODE "1,q")               (FUNCTION TEDIT.QUIT)               TEDIT.READTABLE)        (TEDIT.SETFUNCTION (CHARCODE "1,Q")               (FUNCTION TEDIT.QUIT)               TEDIT.READTABLE))    (CL:WHEN (GETP 'SEDIT 'FILEDATES)                        (* ;                                                            "SEDIT copy: INTERRUPTCHAR does paste")        (SEDIT:ADD-COMMAND "1,c" 'SEDIT.COPYTOCLIPBOARD)        (SEDIT:ADD-COMMAND "1,C" 'SEDIT.COPYTOCLIPBOARD)        (SEDIT:RESET-COMMANDS))])(GETCLIPBOARD  [LAMBDA NIL                                           (* ; "Edited 30-Jul-2020 21:23 by rmk:")                                                            (* ; "Edited 25-Apr-2018 16:56 by rmk:")    (CL:WITH-OPEN-STREAM (s (CREATE-PROCESS-STREAM "pbpaste"))           (\EXTERNALFORMAT s :UTF8)           [SETFILEINFO s 'ENDOFSTREAMOP #'(CL:LAMBDA (s)                                                  (RETFROM (FUNCTION READCCODE)                                                         NIL]           (CONCATCODES (BIND C WHILE (SETQ C (READCCODE s)) COLLECT C])(PUTCLIPBOARD  (CL:LAMBDA (STRING)                                   (* ; "Edited 30-Jul-2020 21:26 by rmk:")                                                            (* ; "Edited 25-Apr-2018 16:49 by rmk:")         (* ;; "Clipboard is UNICODE and UTF8")         (CL:WITH-OPEN-STREAM (s (CREATE-PROCESS-STREAM "pbcopy"))                (\EXTERNALFORMAT s :UTF8)                (PRIN3 STRING s))))(PASTEFROMCLIPBOARD  [LAMBDA NIL                                           (* ; "Edited 18-Apr-2018 13:56 by rmk:")                                                            (* ; "Edited 17-Apr-2018 23:11 by rmk:")    (* ;;   "Should be able to just call COPYINSERT, but the default BKSYSBUF puts in string qujotes ")    (LET ((STR (GETCLIPBOARD)))         (IF (WINDOWPROP (PROCESS.WINDOW (TTY.PROCESS))                        'COPYINSERTFN)             THEN (COPYINSERT STR)           ELSE (BIND C WHILE (SETQ C (GNCCODE STR)) DO (BKSYSCHARCODE C])(LISPINTERRUPTS.PASTE  [LAMBDA NIL                                           (* ; "Edited 18-Apr-2018 22:59 by rmk:")    (* ;; "So paste interrupts will be installed in every process")    (APPEND [LIST (LIST (CHARCODE "1,v")                        '(PASTEFROMCLIPBOARD))                  (LIST (CHARCODE "1,V")                        '(PASTEFROMCLIPBOARD]           (LISPINTERRUPTS.ORIG]))(DEFINEQ(TEDIT.COPYTOCLIPBOARD  [LAMBDA NIL                                           (* ; "Edited 18-Apr-2018 00:02 by rmk:")    (LET [(TEXTSTREAM (TEXTSTREAM (TTY.PROCESS]         (IF TEXTSTREAM             THEN (PUTCLIPBOARD (TEDIT.SEL.AS.STRING TEXTSTREAM])(TEDIT.EXTRACTTOCLIPBOARD  [LAMBDA NIL                                           (* ; "Edited 19-Apr-2020 12:17 by rmk:")                                                            (* ; "Edited 18-Apr-2018 00:02 by rmk:")    (LET [(TEXTSTREAM (TEXTSTREAM (TTY.PROCESS]         (IF TEXTSTREAM             THEN (PUTCLIPBOARD (TEDIT.SEL.AS.STRING TEXTSTREAM))                   (TEDIT.DELETE TEXTSTREAM (TEDIT.GETSEL TEXTSTREAM])(TEDIT.SELECTALL  [LAMBDA (STREAM TEXTOBJ SEL)                          (* ; "Edited  3-May-2020 17:29 by rmk:")    (LET [(TEXTSTREAM (TEXTSTREAM (TTY.PROCESS]         (CL:WHEN TEXTSTREAM             (TEDIT.SETSEL TEXTSTREAM 0 (ADD1 (fetch TEXTLEN of (TEXTOBJ TEXTSTREAM)))                    'LEFT))]))(DEFINEQ(SEDIT.COPYTOCLIPBOARD  [LAMBDA (CONTEXT)                                     (* ; "Edited  5-May-2018 09:43 by rmk:")                                                            (* ; "Edited 24-Apr-2018 20:39 by rmk:")                                                            (* ; "Edited 24-Apr-2018 20:33 by rmk:")                                                            (* ; "Edited 23-Apr-2018 18:19 by rmk:")    (LET (SEL SELTYPE STRING)         (* ;; "SEL could be a list of several elements, or a structure, depending on SELTYPE.  ")         (CL:MULTIPLE-VALUE-SETQ (SEL SELTYPE)                (SEDIT:GET-SELECTION CONTEXT))         (* ;; "SELTYPE=NIL means not a valid selection, and SEL is NIL.  Non-NIL values are :SUB-LIST, :CHARACTERS, and T")         (IF SELTYPE             THEN (SETQ STRING (MKSTRING SEL T))         (* ; " Readtable of caller?")                   (CL:WHEN (OR (EQ SELTYPE :CHARACTERS)                                (AND (EQ SELTYPE :SUB-LIST)                                     (LISTP SEL)))                       (GNC STRING)                          (* ;                         "Peel off outer parens for structures or quotes for atom/string characters")                       (GLC STRING))                   (PUTCLIPBOARD STRING)))    T]))(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DOCOPY (FILESLOAD (SYSLOAD)       UNIXCOMM UNICODE)(INSTALL-CLIPBOARD))(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA )(ADDTOVAR NLAML )(ADDTOVAR LAMA PUTCLIPBOARD))(PUTPROPS CLIPBOARD COPYRIGHT (NONE))(DECLARE%: DONTCOPY  (FILEMAP (NIL (1279 5776 (INSTALL-CLIPBOARD 1289 . 3682) (GETCLIPBOARD 3684 . 4300) (PUTCLIPBOARD 4302 . 4732) (PASTEFROMCLIPBOARD 4734 . 5351) (LISPINTERRUPTS.PASTE 5353 . 5774)) (5777 6865 (TEDIT.COPYTOCLIPBOARD 5787 . 6068) (TEDIT.EXTRACTTOCLIPBOARD 6070 . 6534) (TEDIT.SELECTALL 6536 . 6863)) (6866 8252 (SEDIT.COPYTOCLIPBOARD 6876 . 8250)))))STOP