(DEFINE-FILE-INFO READTABLE "INTERLISP" PACKAGE "INTERLISP")(FILECREATED "24-Jun-2020 20:36:10" {DSK}<Users>kaplan>Local>medley3.5>lispcore>lispusers>MACINTERFACE.;46 11442        changes to%:  (VARS MACINTERFACECOMS)      previous date%: "24-Jun-2020 20:24:02" {DSK}<Users>kaplan>Local>medley3.5>lispcore>lispusers>MACINTERFACE.;45)(PRETTYCOMPRINT MACINTERFACECOMS)(RPAQQ MACINTERFACECOMS       [        (* ;; "Externals")        (COMS (FNS MACWINDOW MACWINDOW.SETUP)              (INITVARS (MACINTERFACECORNERMARGIN 25)))                (* ;; "Internals")        [COMS (FNS INTITLEBAR INCORNER MACWINDOW.BUTTONEVENTFN MACWINDOW.BUTTONEVENTFN.ANYWHERE)                            (* ;; "Behavior for some known window creators")              (FNS MACINT-ADD-EXEC MACINT-SNAPW)              (DECLARE%: DONTEVAL@LOAD DOCOPY (P                                                  (* ;; "Tedit")                                                 (MACWINDOW.SETUP '\TEDIT.BUTTONEVENTFN)                                                                                                  (* ;; "Inspector")                                                 (MACWINDOW.SETUP '\ITEM.WINDOW.BUTTON.HANDLER)                                                                                                  (* ;; "SEDIT")                                                 (MACWINDOW.SETUP 'SEDIT::BUTTONEVENTFN)                                                                                                  (* ;; "Debugger")                                                 (MACWINDOW.SETUP 'DBG::DEBUGGER-BUTTON-EVENT)                                                                                                  (* ;; "Snap")                                                 (MACWINDOW.SETUP 'SNAPW 'MACINT-SNAPW)                                                                                                  (* ;; "New execs")                                                 (MACWINDOW.SETUP 'ADD-EXEC 'MACINT-ADD-EXEC)                                                                                                  (* ;; "Existing exec of the load")                                                 (MACWINDOW (PROCESSPROP (TTY.PROCESS)                                                                   'WINDOW]        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA)                                                                             (NLAML)                                                                             (LAMA MACINT-ADD-EXEC])(* ;; "Externals")(DEFINEQ(MACWINDOW  [LAMBDA (WINDOW ANYWHERE)                             (* ; "Edited 23-Jun-2020 16:01 by rmk:")    (* ;; "This can be applied to windows that have been created with an unknown or unmodifiable buttoneventfn.")    (CL:UNLESS (WINDOWPROP WINDOW 'PREMACBUTTONEVENTFN)        (WINDOWPROP WINDOW 'PREMACBUTTONEVENTFN (WINDOWPROP WINDOW 'BUTTONEVENTFN))        (WINDOWPROP WINDOW 'BUTTONEVENTFN (IF ANYWHERE                                              THEN (FUNCTION MACWINDOW.BUTTONEVENTFN.ANYWHERE)                                            ELSE (FUNCTION MACWINDOW.BUTTONEVENTFN))))    WINDOW])(MACWINDOW.SETUP  [LAMBDA (ORIGFN MACWINDOWFN ANYWHERE)                 (* ; "Edited 24-Jun-2020 15:09 by rmk:")    (* ;; "ORIGFN is either a function that creates windows of a given type (e.g. SNAPW or ADD-EXEC) or the known BUTTONEVENTFN of a class of windows.")    (* ;; "Moves ORIGNFN to a new name, prefixed with MACORIG-.")    (* ;; "If MACWINDOWFN is given, then that replaces the original definition of ORIGFN, and presumably knows how to call the renamed ORIGFN under the write circumstances.  This is typically the case where ORIGFN is a window creator.")    (* ;; "Otherwise, ORIGFN is taken to be the BUTTONEVENTFN for a class of windows, and its new definition is defaulted to one that maps left-clicks in appropriate areas into Mac window operations.  If not in appropriate areas, then the renamed ORIGNFN is called to give the original button behavior.")    (* ;; "If ANYWHERE, moving will happen for any click not in one of the shaping corners.")    (* ;; "The renamed function has arguments in addition to WINDOW:  the new name for the original function, if MACWINDOFN is provided, and the value specified here for ANYWHERE.")    (LET [RENAMEDORIG (PKGNAME (CL:PACKAGE-NAME (CL:SYMBOL-PACKAGE ORIGFN]         (* ;; "The renamed version of XCL symbols go into Interlisp, so there is less confusion about accessing it")         (CL:WHEN (STREQUAL PKGNAME "XEROX-COMMON-LISP")                (SETQ PKGNAME "INTERLISP"))         (SETQ RENAMEDORIG (CL:INTERN (CONCAT 'MACORIG- ORIGFN)                                  PKGNAME))         (MOVD? ORIGFN RENAMEDORIG)         (IF MACWINDOWFN             THEN (MOVD MACWINDOWFN ORIGFN)           ELSE (PUTD ORIGFN `(LAMBDA (WINDOW)                                    (MACWINDOW.BUTTONEVENTFN WINDOW (FUNCTION ,RENAMEDORIG)                                           ,ANYWHERE]))(RPAQ? MACINTERFACECORNERMARGIN 25)(* ;; "Internals")(DEFINEQ(INTITLEBAR  [LAMBDA (WINDOW)                                      (* ; "Edited  3-May-2020 20:38 by rmk:")    (IGREATERP (LASTMOUSEY WINDOW)           (FETCH TOP OF (DSPCLIPPINGREGION NIL WINDOW])(INCORNER  [LAMBDA (WINDOW MARGIN)                               (* ; "Edited 13-May-2020 14:26 by rmk:")                                                            (* ; "Edited 10-May-2020 12:41 by rmk:")                                                            (* ; "Edited  3-May-2020 20:43 by rmk:")    (CL:UNLESS MARGIN (SETQ MARGIN MACINTERFACECORNERMARGIN))    (LET ((CR (DSPCLIPPINGREGION NIL WINDOW))          (X (LASTMOUSEX WINDOW))          (Y (LASTMOUSEY WINDOW)))         (IF (ILEQ (IABS (IDIFFERENCE X (FETCH LEFT OF CR)))                       MARGIN)             THEN                    (* ;; "GREATERP puts it in title bar")                   (IF (IGREATERP Y (FETCH TOP OF CR))                       THEN 'LEFTTOP                     ELSEIF (ILEQ (IABS (IDIFFERENCE Y (FETCH BOTTOM OF CR)))                                      MARGIN)                       THEN 'LEFTBOTTOM)           ELSEIF (ILEQ (IABS (IDIFFERENCE X (FETCH RIGHT OF CR)))                            MARGIN)             THEN (IF (IGREATERP Y (FETCH TOP OF CR))                          THEN 'RIGHTTOP                        ELSEIF (ILEQ (IABS (IDIFFERENCE Y (FETCH BOTTOM OF CR)))                                         MARGIN)                          THEN 'RIGHTBOTTOM])(MACWINDOW.BUTTONEVENTFN  [LAMBDA (WINDOW ORIGFUNCTION ANYWHERE)                (* ; "Edited 24-Jun-2020 20:23 by rmk:")                                                            (* ; "Edited 23-May-2020 08:34 by rmk:")                                                            (* ; "Edited 10-May-2020 03:35 by rmk:")                                                            (* ; "Edited  3-May-2020 21:18 by rmk:")    (IF (AND (MOUSESTATE (ONLY LEFT))                 (EQ LASTKEYBOARD 0))        THEN (TOTOPW WINDOW)              (LET (REGION (CORNER (INCORNER WINDOW)))                   (IF CORNER                       THEN                              (* ;;                      "The upper corners may be in the title bar, near the side, so test this first")                             (SETQ REGION (WINDOWPROP WINDOW 'REGION))                             [LET ((LEFT (FETCH LEFT OF REGION))                                   (RIGHT (FETCH RIGHT OF REGION))                                   (TOP (FETCH TOP OF REGION))                                   (BOTTOM (FETCH BOTTOM OF REGION)))                                  (SHAPEW WINDOW (GETREGION NIL NIL NIL NIL NIL                                                        (SELECTQ CORNER                                                            (RIGHTBOTTOM (LIST LEFT TOP RIGHT BOTTOM))                                                            (LEFTBOTTOM (LIST RIGHT TOP LEFT BOTTOM))                                                            (RIGHTTOP (LIST LEFT BOTTOM RIGHT TOP))                                                            (LEFTTOP (LIST RIGHT BOTTOM LEFT TOP))                                                            (SHOULDNT]                             T                     ELSEIF (OR ANYWHERE (INTITLEBAR WINDOW))                       THEN (MOVEW WINDOW)                             T                     ELSEIF [OR ORIGFUNCTION (SETQ ORIGFUNCTION (WINDOWPROP WINDOW                                                                            'PREMACBUTTONEVENTFN]                       THEN (APPLY* ORIGFUNCTION WINDOW)))      ELSEIF [OR ORIGFUNCTION (SETQ ORIGFUNCTION (WINDOWPROP WINDOW 'PREMACBUTTONEVENTFN]        THEN (APPLY* ORIGFUNCTION WINDOW])(MACWINDOW.BUTTONEVENTFN.ANYWHERE  [LAMBDA (WINDOW)                                      (* ; "Edited 24-Jun-2020 13:24 by rmk:")    (* ;; "Move if left-click anywhere, not just titlebar")    (MACWINDOW.BUTTONEVENTFN NIL T]))(* ;; "Behavior for some known window creators")(DEFINEQ(MACINT-ADD-EXEC  [LAMBDA U                                             (* ; "Edited 24-Jun-2020 14:23 by rmk:")    (LET [(PROC (APPLY (FUNCTION MACORIG-ADD-EXEC)                       (FOR N FROM 1 TO U COLLECT (ARG U N]         (* ;; "For some reason, the window may not be there immediately")         (DISMISS 100)         (MACWINDOW (PROCESSPROP PROC 'WINDOW))         PROC])(MACINT-SNAPW  [LAMBDA NIL                                           (* ; "Edited 24-Jun-2020 13:19 by rmk:")    (* ;; "No point in shaping a snap window, just move it.;;")    (* ;; "This changes the creation function (SNAPW), since snap windows otherwise don't have a BUTTONEVENTN")    (LET ((W (MACORIG-SNAPW)))         [WINDOWPROP W 'BUTTONEVENTFN (FUNCTION (LAMBDA (W)                                                  (TOTOPW W)                                                  (MOVEW W]         W]))(DECLARE%: DONTEVAL@LOAD DOCOPY (* ;; "Tedit")(MACWINDOW.SETUP '\TEDIT.BUTTONEVENTFN)(* ;; "Inspector")(MACWINDOW.SETUP '\ITEM.WINDOW.BUTTON.HANDLER)(* ;; "SEDIT")(MACWINDOW.SETUP 'SEDIT::BUTTONEVENTFN)(* ;; "Debugger")(MACWINDOW.SETUP 'DBG::DEBUGGER-BUTTON-EVENT)(* ;; "Snap")(MACWINDOW.SETUP 'SNAPW 'MACINT-SNAPW)(* ;; "New execs")(MACWINDOW.SETUP 'ADD-EXEC 'MACINT-ADD-EXEC)(* ;; "Existing exec of the load")(MACWINDOW (PROCESSPROP (TTY.PROCESS)                      'WINDOW)))(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA )(ADDTOVAR NLAML )(ADDTOVAR LAMA MACINT-ADD-EXEC))(DECLARE%: DONTCOPY  (FILEMAP (NIL (2704 5275 (MACWINDOW 2714 . 3355) (MACWINDOW.SETUP 3357 . 5273)) (5344 9655 (INTITLEBAR 5354 . 5574) (INCORNER 5576 . 6991) (MACWINDOW.BUTTONEVENTFN 6993 . 9402) (MACWINDOW.BUTTONEVENTFN.ANYWHERE 9404 . 9653)) (9713 10690 (MACINT-ADD-EXEC 9723 . 10147) (MACINT-SNAPW 10149 . 10688)))))STOP