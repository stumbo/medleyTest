(DEFINE-FILE-INFO READTABLE "INTERLISP" PACKAGE "INTERLISP")(FILECREATED "14-Dec-2020 18:36:57" {DSK}<home>larry>ilisp>medley>makesysout>SYNCLISPFILES.;3 15992        changes to%:  (VARS SYNCLISPFILESCOMS MEDLEY-INIT-VARS)                    (FNS MEDLEYDIR MEDLEY-INIT-VARS)      previous date%: "12-Dec-2020 16:12:05" {DSK}<home>larry>ilisp>medley>makesysout>SYNCLISPFILES.;1)(PRETTYCOMPRINT SYNCLISPFILESCOMS)(RPAQQ SYNCLISPFILESCOMS       [(FNS MEDLEYDIR INTERLISPMODE MEDLEY-INIT-VARS)        (COMMANDS cd pwd)        (FNS shell)        (VARS MEDLEY-INIT-VARS)        (FNS SYNCLISPFILES ENDLOADUP MEDLEYVERSION NOPUPPATCH)        (INITVARS (WRITELISPSYSOUTFLAG T))        (DECLARE%: DONTEVAL@LOAD DONTEVAL@COMPILE DOCOPY (P (KEYACTION 'LOCK '(LOCKTOGGLE . IGNORE))                                                            (SYNCLISPFILES)))        (PROP FILETYPE SYNCLISPFILES)        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA shell)                                                                             (NLAML)                                                                             (LAMA])(DEFINEQ(MEDLEYDIR  [LAMBDA (DIRNAME FILENAME OUTPUT)                    (* ; "Edited 14-Dec-2020 17:12 by larry")    (if (NULL DIRNAME)        then (if (OR (NOT (BOUNDP 'MEDLEYDIR))                             (NOT MEDLEYDIR))                     then (OR (SETQ MEDLEYDIR (DIRECTORYNAME (OR (UNIX-GETENV "MEDLEYDIR")                                                                     T)))                                  (DIRECTORYNAME T))                   elseif (STRPOS "/" MEDLEYDIR)                     then (SETQ MEDLEYDIR (DIRECTORYNAME MEDLEYDIR))                   else MEDLEYDIR)      elseif (LISTP DIRNAME)        then (for X in DIRNAME collect (MEDLEYDIR X))      elseif FILENAME        then (SETQ FILENAME (CONCAT (MEDLEYDIR DIRNAME)                                       FILENAME))              (if OUTPUT                  then FILENAME                else (OR (INFILEP FILENAME)                             (ERROR "No such medley file" FILENAME)))      else (OR (DIRECTORYNAME (CONCAT (MEDLEYDIR)                                         DIRNAME))                   (ERROR "No such medley directory" DIRNAME])(INTERLISPMODE  [LAMBDA (OLD?)                                             (* N.H.Briggs " 2-Feb-88 14:26")    (PROCESSPROP 'EXEC 'PROFILE (XCL:COPY-PROFILE (if OLD?                                                      then "OLD-INTERLISP-T"                                                    else "INTERLISP")))    (XCL:SET-DEFAULT-EXEC-TYPE (if OLD?                                   then "OLD-INTERLISP-T"                                 else "INTERLISP"))    (SETQ *DEFAULT-MAKEFILE-ENVIRONMENT* (LIST :READTABLE (if OLD?                                                              then "OLD-INTERLISP-FILE"                                                            else "INTERLISP")                                               :PACKAGE "INTERLISP"])(MEDLEY-INIT-VARS  [LAMBDA (CLEAR)                                      (* ; "Edited 14-Dec-2020 17:30 by larry")    (* ;; "MEDLEY-INIT-VARS has variables that might need to get reset. ")    (if CLEAR        then (SETQ MEDLEYDIR NIL)              (SETQ XCL::*WHERE-IS-CASH-FILES* NIL)              (for X in MEDLEY-INIT-VARS do (SET (CAR X)))      elseif [OR (NOT (BOUNDP 'MEDLEYDIR))                     (AND (NULL MEDLEYDIR)                          (NULL (MEDLEYDIR]        then (PRINTOUT T "WARNING: MEDLEYDIR not set correctly"                         " set it and call (MEDLEY-INIT-VARS) again" T)      else [for X in MEDLEY-INIT-VARS do (SET (CAR X)                                                              (EVAL (CADR X]             (* ;; "WHEREIS doesn't follow conventions")            (CL:WHEN (GETD 'XCL::ADD-WHERE-IS-DATABASE)                (SETQ XCL::*WHERE-IS-CASH-FILES* NIL)                (XCL::ADD-WHERE-IS-DATABASE (MEDLEYDIR "loadups" "WHEREIS.HASH"))                (XCL::ADD-WHERE-IS-DATABASE (MEDLEYDIR "loadups" "system.hash")))            NIL]))(DEFCOMMAND cd (DIR) (/CNDIR DIR))(DEFCOMMAND pwd NIL (DIRECTORYNAME T))(DEFINEQ(shell  [NLAMBDA LINE                                              (* ;                                                            "Edited  7-Sep-2020 13:28 by rmk:")    [SETQ LINE (CONCATLIST (for X in LINE join (LIST X " "]    (CL:WITH-OPEN-FILE (STREAM "{NODIRCORE}shell-dribble.txt" :DIRECTION :IO)           (ShellCommand LINE STREAM)           (SETFILEPTR STREAM 0)           (until (EOFP STREAM) collect (CL:READ-LINE STREAM :EOF-ERROR-P NIL :EOF-VALUE NIL]))(RPAQQ MEDLEY-INIT-VARS       ([LISPUSERSDIRECTORIES (MEDLEYDIR '("library" "lispusers" "internal/library"]        [LISPSOURCEDIRECTORIES (MEDLEYDIR '("sources"]        (LISPSOURCEDIRECTORY (CAR LISPSOURCEDIRECTORIES))        (IRM.HOST&DIR (MEDLEYDIR '"docs/dinfo"))        (IRM.DINFOGRAPH)        (DIRECTORIES (APPEND LISPUSERSDIRECTORIES LISPSOURCEDIRECTORIES))        [LOGINHOST/DIR (DIRECTORYNAME (OR (UNIX-GETENV "LOGINDIR")                                          (UNIX-GETENV "HOME"]        [USERGREETFILES `((,LOGINHOST/DIR "INIT" COM)                          (,LOGINHOST/DIR "INIT"]        [DISPLAYFONTDIRECTORIES (MEDLEYDIR '("fonts/displayfonts" "fonts/altofonts"]        [POSTSCRIPTFONTDIRECTORIES (MEDLEYDIR '("fonts/postscriptfonts"]        [INTERPRESSFONTDIRECTORIES (MEDLEYDIR '("fonts/ipfonts"]        (XCL::*WHERE-IS-CASH-FILES*)))(DEFINEQ(SYNCLISPFILES  [LAMBDA (NODRIBBLE KEEPPUP)                          (* ; "Edited  5-Dec-2020 12:34 by larry")                                                             (* ;                                                            "Edited 23-Oct-2020 23:51 by rmk:")                                                             (* ;                                                            "Edited 20-Apr-2018 18:28 by rmk:")    (* ;; "This ensures that  files in the xlisp.sysout are as up-to-date as possible with respect to lispcore/sources. Reload (compiled, if possible) files that correspond to symbolic files whose filedates are later than the filedate in the system. If you want a new compilation of a file that has not been modified to be included, then you must make a trivial update of the symbolic file and recompile it, to give it a new, later date.  This is because it is unsafe as a general default to load compiled files with dates later than the sysout, and the sysout doesn't record the dates of loaded compiled files, just their symbolic versions.")    (* ;; " Should be run while connected to MEDLEYDIR")    (CLRPROMPT)    (MEDLEY-INIT-VARS)    (if (WINDOWP LOGOW)        then (CLOSEW LOGOW))    (MOVD 'NILL 'LOGOW)    (SETQ LISPMAKESYSDATE MAKESYSDATE)    (LET (SKIPFILES (SOURCEDIR (MEDLEYDIR "sources")))         (SETQ MAKESYSFILENAME (MEDLEYDIR "loadups" "xlisp.sysout" T))         (* ;;       "FASLOAD has to come first, unconditionally, to get the DFASL file dates converted properly.")         (CL:UNLESS NODRIBBLE             (DRIBBLE (MEDLEYDIR "loadups" "xlisp.dribble" T)))         (BKSYSBUF " ")         (PRINTOUT T T "Synchronizing Lisp sysout at " (DATE)                T)         (PRINTOUT T 5 (CDAR (GETP 'SYNCLISPFILES 'FILEDATES))                T 5 "created " (CAAR (GETP 'SYNCLISPFILES 'FILEDATES))                T T)         (push SKIPFILES 'FASLOAD)         (LOAD (MEDLEYDIR "sources" "FASLOAD.DFASL")               'SYSLOAD)         (push SKIPFILES 'ATBL)                          (* ;                                                    "Whole file can't be reloaded--smashes readtabl")         (LOADFNS '(\ATBLSET \MAPCHARTABLE RESETREADTABLE)                (MEDLEYDIR "sources" "ATBL.LCOM")                'SYSLOAD)         (LOADVARS '\KEYNAMES (MEDLEYDIR "sources" "LLKEY")                'SYSLOAD)                                    (* ; "Extended keynames for Mac/PC")         (push SKIPFILES 'LLKEY)                         (* ; "Loading whole file freezes")         (push SKIPFILES 'MAIKOLOADUPFNS)                (* ;                                                     "Can't reload even if compiled files are later")         (push SKIPFILES 'SUNFONT)                       (* ;                                                            "Old font organization, not relevant")         (for LF FF CFILE LOADEDDATE FILEDATE IFILEDATE NOCOMPILEDFILES CFILES (COUNT _ 0)            in (LDIFFERENCE SYSFILES SKIPFILES)            do [[SETQ LOADEDDATE (CAAR (GETP LF 'FILEDATES]                                                             (* ;                                               "Date of symbolic file whose compile file was loaded")                    (CL:UNLESS LOADEDDATE                        (PRINTOUT T T LF                                " does not have a loaded filedate, probably not a Lisp file; skipped"                               T)                        (GO $$ITERATE))                    (SETQ FF (PACKFILENAME.STRING 'NAME LF 'BODY SOURCEDIR))                    (SETQ FILEDATE (FILEDATE FF))            (* ; "Date of current source file")                    (CL:UNLESS FILEDATE                        (PRINTOUT T LF " does not have a file-directory date, not updated" T)                        (GO $$ITERATE))                    (SETQ CFILES (for EXT in *COMPILED-EXTENSIONS*                                    when (SETQ CFILE (INFILEP (PACKFILENAME.STRING 'EXTENSION EXT                                                                         'BODY FF))) collect                                                                                     CFILE))                    (SETQ CFILE (COND                                   [CFILES                                           (* ;;                                         "If more than one (LCOM, DFASL), pick the newest one.")                                          (for CF in CFILES                                             largest (IDATE (FILEDATE CF T]                                   (T (PRINTOUT T "Note: No compiled file for " LF T)                                      (push NOTCOMPILEDFILES LF)                                      FF)))                    (SETQ IFILEDATE (IDATE FILEDATE))                    (CL:UNLESS (IGREATERP IFILEDATE 0)                        (PRINTOUT T "Funny file date " FILEDATE " for " LF ", not updated" T)                        (GO $$ITERATE))                    (* ;; "Load the compiled file if the date of the symbolic file is later than the symbolic file-date in the sysout.  If an updated source and compiled file were copied from another directory, we update the FILEDATES property to point to the new location.  If the loaded and file dates are the same, then update the FILEDATES property to point to the possibly new path name and version even if we don't need to load.")                    (SETQ LOADEDDATE (IDATE LOADEDDATE))                    (if (IGREATERP IFILEDATE LOADEDDATE)                        then (add COUNT 1)                              (LOAD CFILE 'SYSLOAD)                              (CL:WHEN [STREQUAL FILEDATE (CAAR (GETP LF 'FILEDATES]                                  (* ;; "If copied, the compiled file may install the original location.  Not sure what happens with copied DFASLs")                                  (RPLACD (CAR (GETP LF 'FILEDATES))                                         (INFILEP FF)))                      elseif (IEQP IFILEDATE LOADEDDATE)                        then (RPLACD (CAR (GETP LF 'FILEDATES))                                        (INFILEP FF]            finally (PRINTOUT T T T COUNT " files loaded" T)                  (CL:WHEN NOCOMPILEDFILES (PRINTOUT T "Symbolic files loaded:  " .PPVTL                                                   NOCOMPILEDFILES T T)))         (* ;; "Load from patch directory")         (for PF (COUNT _ 0) in (FILDIR (PACKFILENAME.STRING 'NAME "*.;" 'BODY                                                           (MEDLEYDIR "/patches/")))            do (for EXT CFILE in *COMPILED-EXTENSIONS*                      when (SETQ CFILE (INFILEP (PACKFILENAME.STRING 'EXTENSION EXT 'BODY PF)))                      do (add COUNT 1)                            (LOAD CFILE 'SYSLOAD)            (* ; "symbolic file date")                            (RETURN) finally (PRINTOUT T "Note: No compiled file for " PF T)                                           (add COUNT 1)                                           (LOAD PF 'SYSLOAD))            finally (PRINTOUT T T T COUNT " files loaded" T))         (CL:UNLESS KEEPPUP (NOPUPPATCH))         (ENDLOADUP)         (CL:WHEN WRITELISPSYSOUTFLAG             (* ;; "So we print out the new version number")             (SETQ MAKESYSFILENAME (OUTFILEP MAKESYSFILENAME))             (PRINTOUT T "Creating updated LISP sysout on " MAKESYSFILENAME T)             (CLRPROMPT)             (BKSYSBUF (CONCAT "(IL:MAKESYS %"" MAKESYSFILENAME "%" %"Medley Lisp Sysout%")")))         (CL:UNLESS NODRIBBLE (DRIBBLE])(ENDLOADUP  [LAMBDA NIL                                          (* ; "Edited 10-Dec-2020 21:49 by larry")                                                             (* ; "Edited 11-Oct-90 11:02 by jds")    (* ;; "set up for NONET configuration;  sites with ethernet can load in init from other places")    (* ;; "All records existing at this point in time have been loaded as part of the system.")    [MAPC USERRECLST (FUNCTION (LAMBDA (R)                                 (RECORDPRIORITY R 'SYSTEM]    (MEDLEY-INIT-VARS T)    (for X in SYSTEMINITVARS when (NOT (ASSOC X MEDLEY-INIT-VARS))       do (SETTOPVAL (CAR X)                     (COPY (CDR X])(MEDLEYVERSION  [LAMBDA NIL                                                (* ;                                                            "Edited 25-Mar-2018 22:07 by rmk:")                                                             (* ; "Edited 11-Nov-98 22:02 by rmk:")    (SELECTQ (LISPVERSION)        (39424 '|1.1|)        (39539 '|1.15|)        (40960 '|1.2|)        (4928 '|2.0|)        (21000 '|2.1|)        (35000 '|3.5|)        (35010 '|3.5|)        (HELP "UNRECOGNIZED MEDLEY VERSION" (LISPVERSION])(NOPUPPATCH  [LAMBDA NIL                                                (* ;                                                            "Edited 14-May-2018 12:22 by rmk:")    (* ;; "Fix it so pup stuff never gets run")    (SETQ \PROCESSES (DREMOVE (FIND.PROCESS '\PUPGATELISTENER)                            \PROCESSES))    (SETQ \FILEDEVICES (for F in \FILEDEVICES unless (STRPOS "LEAF" F) collect F))    (MOVD 'NILL '\CANONICALIZE.PUP.HOSTNAME]))(RPAQ? WRITELISPSYSOUTFLAG T)(DECLARE%: DONTEVAL@LOAD DONTEVAL@COMPILE DOCOPY (KEYACTION 'LOCK '(LOCKTOGGLE . IGNORE))(SYNCLISPFILES))(PUTPROPS SYNCLISPFILES FILETYPE :TCOMPL)(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA shell)(ADDTOVAR NLAML )(ADDTOVAR LAMA ))(PUTPROPS SYNCLISPFILES COPYRIGHT (NONE))(DECLARE%: DONTCOPY  (FILEMAP (NIL (1179 4418 (MEDLEYDIR 1189 . 2425) (INTERLISPMODE 2427 . 3240) (MEDLEY-INIT-VARS 3242 . 4416)) (4495 5011 (shell 4505 . 5009)) (5883 15588 (SYNCLISPFILES 5893 . 13843) (ENDLOADUP 13845 . 14555) (MEDLEYVERSION 14557 . 15096) (NOPUPPATCH 15098 . 15586)))))STOP